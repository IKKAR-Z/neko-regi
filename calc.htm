<html lang="ja">
	<head>
	<meta charset="utf-8">
	<meta name="viewport"
   		content="width=device-width,
		,user-scalable=no" />
	<style type="text/css">
		<!--
		body{
			user-select: none;
		}
		.srider{
			display: flex;
			justify-content: flex-end;
		}
		h1{
			text-align: center;
			font-size: xx-large;
		}
		.menu-list{
			width: 400px;
			column-count: 2;
		}
		-->
	</style>
	</head>
	<body>
		<div id="area1" class="menu-list">
		</div>
		<p><input type="button" value="消去" onclick="reset()"></p>

		<hr>
		<h1>
			<p id="msg">0</p>
		</h1>
		<hr>
		
		<script>
			let nmax=0;

			let code0="<div id=\"food@\"></div><br><div id=\"price@\"></div> x <div id=\"n@\">0</div><br><div class=\"srider\"><input type=\"range\" id=\"quant@\" min=\"0\" max=\"20\" value=\"0\" step=\"1\"></div><br><br>\n"

			// CSVファイルを取得
			let csv = new XMLHttpRequest();

			// CSVファイルへのパス
			csv.open("GET", "menu-list.csv", false);

			// csvファイル読み込み失敗時のエラー対応
			try {
				csv.send(null);
			} catch (err) {
				console.log(err);
			}

			// 配列を定義
			let csvArray = [];

			// 改行ごとに配列化
			let lines = csv.responseText.split(/\r\n|\n/);

			// 1行ごとに処理

			for (let i = 0; i < lines.length; ++i) {
				let cells = lines[i].split(",");
				if (cells.length != 1) {
					nmax++;
					let str = code0.split("@");
					area1.innerHTML=area1.innerHTML+str.join(i);
					eval('food'+i).innerText=cells[0];
					eval('price'+i).innerText=cells[1];

				}
			}
			console.log("nmax:"+nmax);


			area1.onchange = function calc(){
				let a = 0;
				console.log("nmax:"+nmax);
				for (var j=0, max=nmax; j<max; j++){
					console.log("j:"+j);	
					let price = parseInt(document.getElementById('price'+j).innerText,10);
					let quant = parseInt(document.getElementById('quant'+j).value,10);
					console.log("price:"+price);	
					console.log("quant:"+quant);	
					a = a+price*quant;
				}

				msg.innerText=a;
			}
			function reset(){
				console.log("nmax:"+nmax);
				for (var k=0, max=nmax; k<max; k++){
					console.log("k:"+k);
					document.getElementById('quant'+k).value="0";
					eval('n'+k).innerText="0";
				}
				msg.innerText="0";
			}
			
			for (var i=0, max=nmax; i<max; i++){
				console.log("i:"+i);
				let elem = document.getElementById('quant'+i);
				let target = document.getElementById('n'+i);
				let rangeValue = function (elem, target) {
					return function(evt) {
						target.innerHTML = elem.value;
					}
				}
				elem.addEventListener('input', rangeValue(elem,target));
			}
			
		</script>
	</body>
</html>
